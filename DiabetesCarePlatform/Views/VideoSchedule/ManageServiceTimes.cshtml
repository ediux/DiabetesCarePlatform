@model IEnumerable<DiabetesCarePlatform.Models.ZoomNetMeeting.ServiceTimeViewModel>

@{
    ViewBag.Title = "管理服務時間";
}

<div class="row">
    <div class="col-md-12">
        <div class="panel panel-success">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
                </div>
                <h4 class="panel-title">管理服務時間</h4>
            </div>
            <div class="panel-toolbar">
                <div class="btn-group m-r-5">
                    <a class="btn btn-white" href="@ViewBag.returnUrl" title="上一頁"><i class="fa fa-arrow-left"></i></a>
                </div>
                <div class="btn-group m-r-5">
                    <a class="btn btn-white" href="javascript:btnAdd_Click();" title="新增時段"><i class="fa fa-plus"></i></a>
                    <a class="btn btn-white" href="javascript:btnDelete_Click();" title="刪除時段"><i class="fa fa-remove"></i></a>
                </div>
            </div>
            <div class="row" id="block-addTime">
                <div class="col-md-12">
                    @using (Html.BeginForm("AddServiceTime", "VideoSchedule", FormMethod.Post, new { @class = "form-horizontal" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.Hidden("returnurl", (string)ViewBag.returnUrl)
                        <fieldset class="p-10">
                            <legend>新增服務時間</legend>
                            <div class="form-group">
                                <label class="col-md-2 text-right control-label">服務時間範圍</label>
                                <div class="col-md-6">

                                    <div class="input-group">
                                        <div class="input-group bootstrap-timepicker m-r-5">
                                            <input id="starttime" type="text" class="form-control " name="starttime" placeholder="服務開始時間" />
                                            <span class="input-group-addon"><i class="fa fa-clock-o"></i></span>
                                        </div>
                                        <span class="input-group-addon">至</span>

                                        <div class="input-group bootstrap-timepicker m-l-5">
                                            <input id="endtime" type="text" class="form-control" name="endtim" placeholder="服務結束時間" />
                                            <span class="input-group-addon"><i class="fa fa-clock-o"></i></span>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-2">
                                    <input type="submit" class="btn btn-success" value="增加" id="btn-ok" />
                                    <input type="button" class="btn btn-success" value="取消" id="btn-cancel" />
                                </div>
                            </div>
                        </fieldset>
                    }
                </div>
                <hr class="width-full" />
            </div>
            <div class="panel-body">
                <table id="data-table" class="table table-striped table-bordered nowrap width-full">
                    <thead>
                        <tr>
                            <th>@Html.Geti18nText("ID_1")</th>
                            <th>開始時間</th>
                            <th>結束時間</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var timerow in Model)
                        {
                            <tr>
                                <td>@timerow.TimeSectionId</td>
                                <td>@timerow.StartTime</td>
                                <td>@timerow.EndTime</td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>



@section pagelevelcss{
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-datepicker")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/ionRangeSlider")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/ionRangeSlider-skinNice")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-colorpicker")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-timepicker")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/password-indicator")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-combobox")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-select")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-tagsinput")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/jquery-tag-it")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-daterangepicker")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/select2")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/bootstrap-eonasdan-datetimepicker")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/DataTables")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/pluging/extensions/DataTables-FixedHeader")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/pluging/extensions/DataTables-Select")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/extensions/DataTables-Responsive")" rel="stylesheet" />
    <link href="@Styles.Url("~/assets/css/plugins/gritter")" rel="stylesheet" />
}
@section pageleveljs{
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-datepicker")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/ionRangeSlider")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-colorpicker")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/masked-input")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-timepicker")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/password-indicator")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-combobox")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-select")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-tagsinput")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/jquery-tag-it")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-daterangepicker")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/select2")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/moment2")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/bootstrap-eonasdan-datetimepicker")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/DataTables")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/extensions/DataTables-Responsive")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/extensions/DataTables-FixedHeader")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/extensions/DataTables-Select")"></script>
    <script src="@Scripts.Url("~/assets/js/plugins/gritter")"></script>
    <script src="@Scripts.Url("~/bundles/jqueryval")"></script>
}

@section Scripts {
    <script>
        var selectrowid = null;
        function btnAdd_Click() {
            //$('#modal-dialog-addServiceTime').modal('show');
            dialogAddTime_Show();

        }

        function btnDelete_Click() {
            if (selectrowid == null) {
                alert('請先選擇一個服務時段!');
                return false;
            }

            $.ajax({
                type: 'POST',
                data: { TimeSectionId: selectrowid },
                headers: {
                    'RequestVerificationToken': '@RazorHelperFunctions.GetAntiForgeryToken()'
                },
                url: '@Url.Action("DeleteServiceTime", "VideoSchedule")',
                cache: false,
                async: false,
                success: function (data) {
                    window.location = '@Request.Path';
                },
                error: function (data) {
                    selectrowid = null;
                    $('#remainingmeetingroom').text('Error');
                }
            });


        }

        function dialogAddTime_Hide() {
            $('#block-addTime').hide();
        }

        function dialogAddTime_Show() {
            $('#block-addTime').show();
        }
        @*$.ajax({
            type: 'GET',
            url: '@Url.Action("GetRemainingMeetingRoomsAmount", "VideoSchedule")?selectdate=' + strd + '&timeseq=' + this.value,
            cache: false,
            success: function (data) {
                $('#remainingmeetingroom').text(data);
            },
            error: function (data) {
                $('#remainingmeetingroom').text('Error');
            }
        });*@

        function page_init() {
            $('.page-header').hide();
            $('#btn-cancel').click(function () {
                dialogAddTime_Hide();
            });
            $('#starttime').timepicker({
                minuteStep: 1,
                showSeconds: false,
                showMeridian: false,
                defaultTime: '@string.Format("{0}:00", DateTime.Now.TimeOfDay.Hours)'
            });
            $('#endtime').timepicker({
                minuteStep: 1,
                showSeconds: false,
                showMeridian: false,
                defaultTime: '@string.Format("{0}:00", DateTime.Now.AddHours(60).TimeOfDay.Hours)'
            });
            dialogAddTime_Hide();

            if ($('#data-table').length !== 0) {
                var table = $('#data-table').DataTable({
                    select: true,
                    header: true,
                    headerOffset: $('#header').height(),
                    responsive: true
                });

                table.on('select', function (e, dt, type, indexes) {
                    console.debug('selected:' + type);

                    if (type === 'row') {
                        var data = table.row(indexes).data();
                        selectrowid = data[0];
                        console.log(selectrowid);
                        // do something with the ID of the selected items
                    }
                });
            }
        }
    </script>
}